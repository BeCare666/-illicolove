<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>paiement</title>
    <link href="./../assets/img/illicolove-.png" rel="icon">
    <script src="https://api.feexpay.me/feexpay-javascript-sdk/index.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-database.js"></script>
     <!-- Link to import alert personnal -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.2/dist/sweetalert2.all.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.2/dist/sweetalert2.min.css">
</head>
<body>
    <div id="render" style="width: 40vh !important; position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);"></div>
    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    const firebaseConfig = {
    apiKey: "AIzaSyCDGjJ1-gLtw0__8Om8OEzbXYNgBPWw1ik",
    authDomain: "illicolove0.firebaseapp.com",
    databaseURL: "https://illicolove0-default-rtdb.firebaseio.com",
    projectId: "illicolove0",
    storageBucket: "illicolove0.appspot.com",
    messagingSenderId: "687063035754",
    appId: "1:687063035754:web:7f03061d8cd5fd0ee9bf13"
    };
      // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    import {
      getDatabase,
      ref,
      set,
      update,
      child,
      onValue,
      remove,
      get,
    } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

    import { getStorage, getDownloadURL 
    } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js"      
    const db = getDatabase();
    const UserConnectuser = localStorage.getItem("unserconnect");
    const MyComptaval = localStorage.getItem("myComptaval");
    const variablenx = localStorage.getItem('unityVal');
    const Debitva = localStorage.getItem('Debitval');
    alert(MyComptaval)
    FeexPayButton.init("render",{
    id: "64b7a5536efe766ee1327ad8",
    amount: `${variablenx}`,
    token:"fp_hdL0LQPAKXx3RzBkjK3nmeoW3fURHK2UxetQBZ7AMP9nGrRyx33FEq2UjlckXok5",
    callback: () => {
    // Appeler la fonction définie dans le DOM
    paymentCallback();
  },
    mode:'live',
    description: "Test",
    })
    //la reponse du payement feexpay
    function paymentCallback() {
    // Cette fonction sera appelée après le paiement réussi 
    var paymentId = true;
    if (paymentId) {
    var myComptaConvertis = parseFloat(MyComptaval);
    var debitConvertis = parseFloat(Debitva)

    var moncomptvalide = myComptaConvertis + debitConvertis

    update(ref(db, "utilisateurs/" + UserConnectuser), {
    COMPTECREDIT:moncomptvalide
    }).then(() => {  
                        
      window.location.href = "profil.html"
    })
    .catch((error) => {
    Swal.fire({
    text: i18next.t('IDTRANSLATEPROFIL45'),
    icon: 'error'
    });
    });  

    } else {
    Swal.fire({
    text: i18next.t('IDTRANSLATEPROFIL44'),
    icon: 'error'
    });
    }
    }
    const renderDiv = document.getElementById('render');
    renderDiv.addEventListener('click', function() {
    renderDiv.style.position = '';
    renderDiv.style.top = '';
    renderDiv.style.left = '';
    renderDiv.style.transform = '';
    });

    </script>
     <script src="./../translate.js"></script>
</body>
</html>